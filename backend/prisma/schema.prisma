// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Transaction {
  id          String   @id
  user_id     String
  type        String
  amount      Float
  date        String
  category    String?
  description String?
  created_at  DateTime @default(now())

  @@index([user_id])
  @@map("transactions")
}

model Split {
  id         String   @id
  user_id    String
  name       String
  frequency  String
  categories String   // JSON stored as string
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@index([user_id])
  @@map("splits")
}

model Purchase {
  id             String   @id
  user_id        String
  split_id       String
  transaction_id String?
  date           String
  amount         Float
  category       String
  description    String?
  created_at     DateTime @default(now())

  @@index([user_id])
  @@index([split_id])
  @@map("purchases")
}

model IncomeSetting {
  id                          String   @id
  user_id                     String
  split_id                    String   @unique
  expected_amount             Float    @default(0)
  frequency                   String   @default("monthly")
  next_payday                 String?
  use_expected_when_no_actual Boolean  @default(true)
  created_at                  DateTime @default(now())
  updated_at                  DateTime @default(now()) @updatedAt

  @@index([user_id])
  @@map("income_settings")
}

// TrueLayer Open Banking Integration
model BankConnection {
  id               String    @id @default(uuid())
  user_id          String
  provider         String    @default("truelayer")
  access_token     String
  refresh_token    String?
  token_expires_at DateTime?
  created_at       DateTime  @default(now())

  @@unique([user_id, provider], name: "user_id_provider")
  @@index([user_id])
  @@map("bank_connections")
}

model BankAccount {
  id                  String   @id @default(uuid())
  user_id             String
  provider            String   @default("truelayer")
  provider_account_id String
  account_name        String?
  currency            String?
  balance             Float?
  available_balance   Float?
  created_at          DateTime @default(now())
  updated_at          DateTime @default(now()) @updatedAt

  @@unique([user_id, provider, provider_account_id], name: "user_id_provider_provider_account_id")
  @@index([user_id])
  @@map("bank_accounts")
}
